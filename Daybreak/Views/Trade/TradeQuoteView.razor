<div class="stretch-container">
    <div class="title-bar-additional-btns-left">
        <button class="title-bar-btn" @onclick="this.ViewModel.DeleteAlert" title="Delete alert">
            <FluentIcon Value="new Icons.Regular.Size16.Delete()" />
        </button>
    </div>
    @if (this.ViewModel.Alert is not null)
    {
        <div class="backdrop-panel">
            <div class="container">
                <div class="alert-row alert-enabled">
                    <FluentInputLabel Label="Enabled" />
                    <FluentCheckbox @bind-Value="@this.ViewModel.Alert.Enabled" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
                <div class="alert-row alert-id">
                    <FluentInputLabel Label="ID" />
                    <FluentTextField @bind-Value="@this.ViewModel.Alert.Id" ReadOnly="true" />
                </div>
                <div class="alert-row alert-name">
                    <FluentInputLabel Label="Name" />
                    <FluentTextField @bind-Value="@this.ViewModel.Alert.Name" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
                <div class="alert-row alert-item">
                    <FluentInputLabel Label="Item" />
                    <FluentSelect TOption="Daybreak.Shared.Models.Guildwars.ItemBase"
                                  Items="@ItemOptions"
                                  OptionText="@(i => i.Name ?? $"Item {i.Id}")"
                                  OptionValue="@(i => i.Id.ToString())"
                                  @bind-SelectedOption="SelectedItem"
                                  @bind-SelectedOption:after="@OnItemSelected" />
                </div>
                <div class="alert-row alert-quote-upper-price-check">
                    <FluentInputLabel Label="Upper price target enabled" />
                    <FluentCheckbox @bind-Value="@this.ViewModel.Alert.UpperPriceTargetEnabled" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
                <div class="alert-row alert-quote-upper-price">
                    <FluentInputLabel Label="Upper price target" />
                    <FluentNumberField @bind-Value="@this.ViewModel.Alert.UpperPriceTarget" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
                <div class="alert-row alert-quote-lower-price-check">
                    <FluentInputLabel Label="Lower price target enabled" />
                    <FluentCheckbox @bind-Value="@this.ViewModel.Alert.LowerPriceTargetEnabled" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
                <div class="alert-row alert-quote-lower-price">
                    <FluentInputLabel Label="Lower price target" />
                    <FluentNumberField @bind-Value="@this.ViewModel.Alert.LowerPriceTarget" @bind-Value:after="@this.ViewModel.SaveAlertChanges" />
                </div>
            </div>
        </div>
    }
</div>

@page "/trade/quote/{AlertId}"
@inherits ViewBase<TradeQuoteView, TradeQuoteViewModel>
@code{
    [Parameter]
    public required string AlertId { get; init; }

    private IEnumerable<Daybreak.Shared.Models.Guildwars.ItemBase> ItemOptions =>
        Daybreak.Shared.Models.Guildwars.ItemBase.AllItems
            .OrderBy(i => i.Name ?? string.Empty);

    private Daybreak.Shared.Models.Guildwars.ItemBase? SelectedItem
    {
        get => ItemOptions.FirstOrDefault(i => i.Id == this.ViewModel.Alert?.ItemId);
        set
        {
            if (this.ViewModel.Alert is not null && value is not null)
            {
                this.ViewModel.Alert.ItemId = value.Id;
            }
        }
    }

    private void OnItemSelected()
    {
        this.ViewModel.SaveAlertChanges();
    }
}