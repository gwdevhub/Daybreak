<div class="logs-container">
    <div class="title-bar-additional-btns-left">
        <button class="title-bar-btn" @onclick="this.ViewModel.ClearLogs" title="Clear logs">
            <FluentIcon Value="new Icons.Regular.Size16.Delete()" />
        </button>
        <button class="title-bar-btn" @onclick="this.ViewModel.ToggleAutoScroll" title="@(this.ViewModel.AutoScroll ? "Disable auto-scroll" : "Enable auto-scroll")">
            @if (this.ViewModel.AutoScroll)
            {
                <FluentIcon Value="new Icons.Regular.Size16.ArrowDown()" />
            }
            else
            {
                <FluentIcon Value="new Icons.Regular.Size16.ArrowDownloadOff()" />
            }
        </button>
    </div>
    
    <div class="stretch-container backdrop-panel">
        <div class="console-container" @ref="this.consoleContainer" tabindex="0">
            <div class="console-output">
                @foreach (var log in this.ViewModel.Logs)
                {
                    <div class="console-entry @this.GetLogLevelClass(log.LogLevel)">
                        <div class="log-header">
                            <span class="log-timestamp">[@log.LogTime.ToString("u")]</span>
                            <span class="log-level-badge">[@this.GetLogLevelText(log.LogLevel)]</span>
                            @if (!string.IsNullOrEmpty(log.Category))
                            {
                                <span class="log-category">[@log.Category]</span>
                            }
                            @if (!string.IsNullOrEmpty(log.EventId))
                            {
                                <span class="log-event-id">[@log.EventId]</span>
                            }
                        </div>
                        <div class="log-message">@log.Message?.Trim()</div>
                    </div>
                }
            </div>
            
            @if (!this.ViewModel.Logs.Any())
            {
                <div class="no-logs">
                    <span>No logs available</span>
                </div>
            }
        </div>
    </div>
</div>

@page "/logs"
@inherits ViewBase<LogsView, LogsViewModel>
@using Microsoft.Extensions.Logging
@code {
    private ElementReference consoleContainer;

    private string GetLogLevelClass(LogLevel level) => level switch
    { 
        LogLevel.Information => "log-info",
        LogLevel.Warning => "log-warning",
        LogLevel.Error => "log-error",
        LogLevel.Critical => "log-critical",
        _ => "log-default"
    };

    private string GetLogLevelText(LogLevel level) => level switch
    {
        LogLevel.Information => "INFO",
        LogLevel.Warning => "WARN",
        LogLevel.Error => "ERRO",
        LogLevel.Critical => "CRIT",
        _ => "????"
    };
}
